<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Teachers CRUD</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .form-group {
            margin: 10px 0;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-success:hover {
            background: #218838;
        }
        .teacher-list {
            margin-top: 20px;
        }
        .teacher-item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .teacher-item h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .teacher-item p {
            margin: 5px 0;
            color: #666;
        }
        .teacher-actions {
            margin-top: 10px;
        }
        .search-box {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            flex: 1;
        }
        .stat-card h3 {
            margin: 0;
            color: #007bff;
        }
        .stat-card p {
            margin: 5px 0 0 0;
            color: #666;
        }
        .log {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Teachers CRUD Operations</h1>
        
        <!-- Statistics -->
        <div class="stats">
            <div class="stat-card">
                <h3 id="totalTeachers">0</h3>
                <p>T·ªïng gi√°o vi√™n</p>
            </div>
            <div class="stat-card">
                <h3 id="withAddress">0</h3>
                <p>C√≥ ƒë·ªãa ch·ªâ</p>
            </div>
        </div>

        <!-- Search -->
        <input type="text" id="searchInput" class="search-box" placeholder="T√¨m ki·∫øm gi√°o vi√™n...">

        <!-- Create Form -->
        <div class="test-section">
            <h3>üìù T·∫°o gi√°o vi√™n m·ªõi</h3>
            <form id="createForm">
                <div class="form-group">
                    <label for="name">T√™n *</label>
                    <input type="text" id="name" required>
                </div>
                <div class="form-group">
                    <label for="email">Email *</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="phone">S·ªë ƒëi·ªán tho·∫°i</label>
                    <input type="tel" id="phone">
                </div>
                <div class="form-group">
                    <label for="address">ƒê·ªãa ch·ªâ</label>
                    <textarea id="address" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="role">Vai tr√≤ *</label>
                    <select id="role" required>
                        <option value="teacher">Gi√°o vi√™n</option>
                        <option value="admin">Qu·∫£n tr·ªã vi√™n</option>
                        <option value="student">H·ªçc sinh</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success">T·∫°o gi√°o vi√™n</button>
            </form>
        </div>

        <!-- Teachers List -->
        <div class="test-section">
            <h3>üìã Danh s√°ch gi√°o vi√™n</h3>
            <div id="teacherList" class="teacher-list">
                <!-- Teachers will be displayed here -->
            </div>
        </div>

        <!-- Test Actions -->
        <div class="test-section">
            <h3>üß™ Test Actions</h3>
            <button onclick="runAllTests()" class="btn">Ch·∫°y t·∫•t c·∫£ tests</button>
            <button onclick="clearAll()" class="btn btn-danger">X√≥a t·∫•t c·∫£</button>
            <button onclick="loadSampleData()" class="btn">T·∫£i d·ªØ li·ªáu m·∫´u</button>
        </div>

        <!-- Log -->
        <div class="test-section">
            <h3>üìù Test Log</h3>
            <div id="log" class="log"></div>
        </div>
    </div>

    <script>
        // Mock data storage
        let teachers = [];
        let nextId = 1;

        // DOM elements
        const createForm = document.getElementById('createForm');
        const teacherList = document.getElementById('teacherList');
        const searchInput = document.getElementById('searchInput');
        const log = document.getElementById('log');

        // Logging function
        function logMessage(message) {
            const timestamp = new Date().toLocaleTimeString();
            log.innerHTML += `[${timestamp}] ${message}\n`;
            log.scrollTop = log.scrollHeight;
        }

        // Generate teacher code
        function generateTeacherCode() {
            return `GV${Date.now().toString().slice(-6)}`;
        }

        // Validate teacher data
        function validateTeacher(data) {
            if (!data.name || data.name.trim().length < 2) {
                logMessage('‚ùå T√™n ph·∫£i c√≥ √≠t nh·∫•t 2 k√Ω t·ª±');
                return false;
            }
            if (!data.email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(data.email)) {
                logMessage('‚ùå Email kh√¥ng h·ª£p l·ªá');
                return false;
            }
            if (!data.role || !['admin', 'teacher', 'student'].includes(data.role)) {
                logMessage('‚ùå Vai tr√≤ kh√¥ng h·ª£p l·ªá');
                return false;
            }
            return true;
        }

        // Create teacher
        function createTeacher(data) {
            if (!validateTeacher(data)) {
                return null;
            }

            const teacher = {
                id: `teacher-${nextId++}`,
                user_id: `user-${nextId}`,
                teacher_code: generateTeacherCode(),
                name: data.name,
                email: data.email,
                phone: data.phone || '',
                address: data.address || '',
                role: data.role,
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            };

            teachers.push(teacher);
            logMessage(`‚úÖ T·∫°o gi√°o vi√™n: ${teacher.name} (${teacher.teacher_code})`);
            updateDisplay();
            return teacher;
        }

        // Update teacher
        function updateTeacher(id, data) {
            const index = teachers.findIndex(t => t.id === id);
            if (index === -1) {
                logMessage('‚ùå Kh√¥ng t√¨m th·∫•y gi√°o vi√™n');
                return null;
            }

            if (!validateTeacher(data)) {
                return null;
            }

            teachers[index] = {
                ...teachers[index],
                name: data.name,
                email: data.email,
                phone: data.phone || '',
                address: data.address || '',
                role: data.role,
                updated_at: new Date().toISOString()
            };

            logMessage(`‚úÖ C·∫≠p nh·∫≠t gi√°o vi√™n: ${teachers[index].name}`);
            updateDisplay();
            return teachers[index];
        }

        // Delete teacher
        function deleteTeacher(id) {
            const index = teachers.findIndex(t => t.id === id);
            if (index === -1) {
                logMessage('‚ùå Kh√¥ng t√¨m th·∫•y gi√°o vi√™n');
                return false;
            }

            const teacher = teachers[index];
            teachers.splice(index, 1);
            logMessage(`‚úÖ X√≥a gi√°o vi√™n: ${teacher.name}`);
            updateDisplay();
            return true;
        }

        // Search teachers
        function searchTeachers(query) {
            if (!query) return teachers;
            
            return teachers.filter(teacher => 
                teacher.name.toLowerCase().includes(query.toLowerCase()) ||
                teacher.email.toLowerCase().includes(query.toLowerCase()) ||
                teacher.teacher_code.toLowerCase().includes(query.toLowerCase())
            );
        }

        // Update display
        function updateDisplay() {
            const query = searchInput.value;
            const filteredTeachers = searchTeachers(query);
            
            teacherList.innerHTML = '';
            
            if (filteredTeachers.length === 0) {
                teacherList.innerHTML = '<p>Kh√¥ng c√≥ gi√°o vi√™n n√†o</p>';
            } else {
                filteredTeachers.forEach(teacher => {
                    const teacherDiv = document.createElement('div');
                    teacherDiv.className = 'teacher-item';
                    teacherDiv.innerHTML = `
                        <h4>${teacher.name} (${teacher.teacher_code})</h4>
                        <p><strong>Email:</strong> ${teacher.email}</p>
                        <p><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> ${teacher.phone || 'Ch∆∞a c·∫≠p nh·∫≠t'}</p>
                        <p><strong>ƒê·ªãa ch·ªâ:</strong> ${teacher.address || 'Ch∆∞a c·∫≠p nh·∫≠t'}</p>
                        <p><strong>Vai tr√≤:</strong> ${teacher.role}</p>
                        <div class="teacher-actions">
                            <button onclick="editTeacher('${teacher.id}')" class="btn">S·ª≠a</button>
                            <button onclick="deleteTeacher('${teacher.id}')" class="btn btn-danger">X√≥a</button>
                        </div>
                    `;
                    teacherList.appendChild(teacherDiv);
                });
            }

            // Update statistics
            document.getElementById('totalTeachers').textContent = teachers.length;
            document.getElementById('withAddress').textContent = teachers.filter(t => t.address && t.address.trim()).length;
        }

        // Edit teacher
        function editTeacher(id) {
            const teacher = teachers.find(t => t.id === id);
            if (!teacher) return;

            document.getElementById('name').value = teacher.name;
            document.getElementById('email').value = teacher.email;
            document.getElementById('phone').value = teacher.phone;
            document.getElementById('address').value = teacher.address;
            document.getElementById('role').value = teacher.role;

            // Change form to update mode
            createForm.onsubmit = (e) => {
                e.preventDefault();
                const formData = {
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    address: document.getElementById('address').value,
                    role: document.getElementById('role').value
                };
                
                updateTeacher(id, formData);
                createForm.reset();
                createForm.onsubmit = handleCreate;
            };
        }

        // Handle create form
        function handleCreate(e) {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                role: document.getElementById('role').value
            };
            
            createTeacher(formData);
            createForm.reset();
        }

        // Load sample data
        function loadSampleData() {
            const sampleTeachers = [
                {
                    name: 'Nguy·ªÖn VƒÉn A',
                    email: 'nguyenvana@example.com',
                    phone: '0901234567',
                    address: '123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM',
                    role: 'teacher'
                },
                {
                    name: 'Tr·∫ßn Th·ªã B',
                    email: 'tranthib@example.com',
                    phone: '0907654321',
                    address: '456 ƒê∆∞·ªùng XYZ, Qu·∫≠n 2, TP.HCM',
                    role: 'teacher'
                }
            ];

            sampleTeachers.forEach(teacher => {
                createTeacher(teacher);
            });
        }

        // Run all tests
        function runAllTests() {
            logMessage('üöÄ B·∫Øt ƒë·∫ßu test CRUD...');
            
            // Test CREATE
            logMessage('üìù Test CREATE...');
            const newTeacher = createTeacher({
                name: 'Test User',
                email: 'test@example.com',
                phone: '0901111111',
                address: 'Test Address',
                role: 'teacher'
            });
            
            if (newTeacher) {
                logMessage('‚úÖ CREATE test passed');
                
                // Test UPDATE
                logMessage('‚úèÔ∏è Test UPDATE...');
                const updated = updateTeacher(newTeacher.id, {
                    name: 'Test User Updated',
                    email: 'testupdated@example.com',
                    phone: '0902222222',
                    address: 'Updated Address',
                    role: 'teacher'
                });
                
                if (updated) {
                    logMessage('‚úÖ UPDATE test passed');
                }
                
                // Test DELETE
                logMessage('üóëÔ∏è Test DELETE...');
                const deleted = deleteTeacher(newTeacher.id);
                if (deleted) {
                    logMessage('‚úÖ DELETE test passed');
                }
            }
            
            // Test SEARCH
            logMessage('üîç Test SEARCH...');
            const searchResults = searchTeachers('Nguy·ªÖn');
            logMessage(`‚úÖ SEARCH test passed - Found ${searchResults.length} results`);
            
            logMessage('üéâ T·∫•t c·∫£ tests ho√†n th√†nh!');
        }

        // Clear all data
        function clearAll() {
            teachers = [];
            updateDisplay();
            logMessage('üóëÔ∏è ƒê√£ x√≥a t·∫•t c·∫£ d·ªØ li·ªáu');
        }

        // Initialize
        createForm.onsubmit = handleCreate;
        searchInput.oninput = updateDisplay;
        
        logMessage('üß™ Teachers CRUD Test Interface ƒë√£ s·∫µn s√†ng!');
        updateDisplay();
    </script>
</body>
</html>

